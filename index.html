<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nil</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <video autoplay muted loop playsinline id="bgVideo">
        <source src="background.mp4" type="video/mp4">
    </video>
    
    <div class="container">
        <button class="arrow-button" id="arrowButton">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        </button>
        
        <div class="user-card" id="userCard">
            <div class="avatar-container">
                <div class="avatar" id="avatar"></div>
                <div class="status-indicator offline" id="statusIndicator"></div>
            </div>
            
            <div class="user-info">
                <div class="username" id="username">sec</div>
                <a class="guild-link" id="guildLink" style="display: none;">
                    <img class="guild-badge" id="guildBadge" src="" alt="">
                    <span class="guild-tag" id="guildTag"></span>
                </a>
            </div>

            <div class="spotify-container" id="spotifyContainer" style="display: none;">
                <div class="spotify-header">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#ffffff"> <path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/> </svg>
                    <span>Listening to Spotify</span>
                </div>
                <div class="spotify-info">
                    <img class="spotify-album" id="spotifyAlbum" src="" alt="">
                    <div class="spotify-details">
                        <div class="spotify-song" id="spotifySong"></div>
                        <div class="spotify-artist" id="spotifyArtist"></div>
                        <div class="spotify-progress">
                            <div class="spotify-progress-bar" id="spotifyProgress"></div>
                        </div>
                        <div class="spotify-time">
                            <span id="spotifyCurrent">0:00</span>
                            <span id="spotifyEnd">0:00</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="activitiesContainer"></div>
        </div>
        
        <div class="projects-panel" id="projectsPanel">
            <h2 class="projects-title">projects</h2>
            <div class="projects-content">
                none lmao
            </div>
        </div>
    </div>

    <script>
        const userId = '1444435506958962938';
        
        let spotifyInterval;
        let isPanelOpen = false;

        document.getElementById('arrowButton').addEventListener('click', () => {
            const userCard = document.getElementById('userCard');
            const projectsPanel = document.getElementById('projectsPanel');
            const arrowButton = document.getElementById('arrowButton');
            
            isPanelOpen = !isPanelOpen;
            
            if (isPanelOpen) {
                userCard.classList.add('shifted');
                projectsPanel.classList.add('visible');
                arrowButton.classList.add('rotated');
            } else {
                userCard.classList.remove('shifted');
                projectsPanel.classList.remove('visible');
                arrowButton.classList.remove('rotated');
            }
        });

        const formatTime = ms => {
            const s = Math.floor(ms / 1000);
            return `${Math.floor(s / 60)}:${String(s % 60).padStart(2, '0')}`;
        };

        const startSpotifyProgress = (spotify) => {
            clearInterval(spotifyInterval);

            const start = spotify.timestamps.start;
            const end = spotify.timestamps.end;

            const tick = () => {
                const now = Date.now();
                const elapsed = Math.min(now - start, end - start);
                const percent = (elapsed / (end - start)) * 100;

                document.getElementById('spotifyProgress').style.width = percent + '%';
                document.getElementById('spotifyCurrent').textContent = formatTime(elapsed);
                document.getElementById('spotifyEnd').textContent = formatTime(end - start);
            };

            tick();
            spotifyInterval = setInterval(tick, 1000);
        };

        fetch(`https://api.lanyard.rest/v1/users/${userId}`)
            .then(res => res.json())
            .then(lanyardData => {
                if (lanyardData.success && lanyardData.data) {
                    const userData = lanyardData.data.discord_user;
                    const status = lanyardData.data.discord_status;
                    
                    const displayName = userData.global_name || userData.username;
                    document.getElementById('username').textContent = displayName;
                    document.title = displayName;

                    if (userData.avatar) {
                        const avatarUrl = `https://cdn.discordapp.com/avatars/${userId}/${userData.avatar}.png?size=256`;
                        document.getElementById('avatar').innerHTML = `<img src="${avatarUrl}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                    }

                    if (userData.primary_guild) {
                        const guild = userData.primary_guild;
                        const guildLink = document.getElementById('guildLink');
                        const guildBadge = document.getElementById('guildBadge');
                        const guildTag = document.getElementById('guildTag');
                        
                        guildBadge.src = `https://cdn.discordapp.com/clan-badges/${guild.identity_guild_id}/${guild.badge}.png`;
                        guildTag.textContent = guild.tag;
                        guildLink.style.display = 'flex';
                    }
                    
                    const indicator = document.getElementById('statusIndicator');
                    indicator.className = 'status-indicator';
                    indicator.classList.add(status || 'offline');

                    if (lanyardData.data.spotify) {
                        const spotify = lanyardData.data.spotify;
                        document.getElementById('spotifyContainer').style.display = 'block';
                        document.getElementById('spotifyAlbum').src = spotify.album_art_url;
                        document.getElementById('spotifySong').textContent = spotify.song;
                        document.getElementById('spotifyArtist').textContent = spotify.artist;
                        startSpotifyProgress(spotify);
                    }

                    const activitiesContainer = document.getElementById('activitiesContainer');
                    activitiesContainer.innerHTML = '';
                    
                    if (lanyardData.data.activities && lanyardData.data.activities.length > 0) {
                        lanyardData.data.activities.forEach(activity => {
                            if (activity.type === 4) {
                                const customDiv = document.createElement('div');
                                customDiv.className = 'activity-card custom-status';
                                customDiv.innerHTML = `
                                    <div class="activity-label">stat</div>
                                    <div class="activity-text">${activity.state || ''}</div>
                                `;
                                activitiesContainer.appendChild(customDiv);
                            } else if (activity.type === 0) {
                                const activityDiv = document.createElement('div');
                                activityDiv.className = 'activity-card';
                                
                                let largeImage = '';
                                if (activity.assets && activity.assets.large_image) {
                                    if (activity.assets.large_image.startsWith('mp:')) {
                                        largeImage = activity.assets.large_image.replace('mp:', 'https://media.discordapp.net/');
                                    } else {
                                        largeImage = `https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.large_image}.png`;
                                    }
                                }
                                
                                activityDiv.innerHTML = `
                                    <div class="activity-header">
                                        <div class="activity-label">${activity.name}</div>
                                    </div>
                                    <div class="activity-content">
                                        ${largeImage ? `<img class="activity-image" src="${largeImage}" alt="">` : ''}
                                        <div class="activity-details">
                                            ${activity.details ? `<div class="activity-details-text">${activity.details}</div>` : ''}
                                            ${activity.state ? `<div class="activity-state-text">${activity.state}</div>` : ''}
                                        </div>
                                    </div>
                                `;
                                activitiesContainer.appendChild(activityDiv);
                            }
                        });
                    }
                    
                    const ws = new WebSocket('wss://api.lanyard.rest/socket');
                    
                    ws.onopen = () => {};
                    
                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        
                        if (data.op === 1) {
                            ws.send(JSON.stringify({
                                op: 2,
                                d: { subscribe_to_id: userId }
                            }));
                        } else if (data.op === 0) {
                            if (data.t === 'INIT_STATE' || data.t === 'PRESENCE_UPDATE') {
                                const newStatus = data.d.discord_status;
                                const indicator = document.getElementById('statusIndicator');
                                indicator.className = 'status-indicator';
                                indicator.classList.add(newStatus || 'offline');

                                if (data.d.spotify) {
                                    const spotify = data.d.spotify;
                                    document.getElementById('spotifyContainer').style.display = 'block';
                                    document.getElementById('spotifyAlbum').src = spotify.album_art_url;
                                    document.getElementById('spotifySong').textContent = spotify.song;
                                    document.getElementById('spotifyArtist').textContent = spotify.artist;
                                    startSpotifyProgress(spotify);
                                } else {
                                    document.getElementById('spotifyContainer').style.display = 'none';
                                }

                                const activitiesContainer = document.getElementById('activitiesContainer');
                                activitiesContainer.innerHTML = '';
                                
                                if (data.d.activities && data.d.activities.length > 0) {
                                    data.d.activities.forEach(activity => {
                                        if (activity.type === 4) {
                                            const customDiv = document.createElement('div');
                                            customDiv.className = 'activity-card custom-status';
                                            customDiv.innerHTML = `
                                                <div class="activity-label">stat</div>
                                                <div class="activity-text">${activity.state || ''}</div>
                                            `;
                                            activitiesContainer.appendChild(customDiv);
                                        } else if (activity.type === 0) {
                                            const activityDiv = document.createElement('div');
                                            activityDiv.className = 'activity-card';
                                            
                                            let largeImage = '';
                                            if (activity.assets && activity.assets.large_image) {
                                                if (activity.assets.large_image.startsWith('mp:')) {
                                                    largeImage = activity.assets.large_image.replace('mp:', 'https://media.discordapp.net/');
                                                } else {
                                                    largeImage = `https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.large_image}.png`;
                                                }
                                            }
                                            
                                            activityDiv.innerHTML = `
                                                <div class="activity-header">
                                                    <div class="activity-label">${activity.name}</div>
                                                </div>
                                                <div class="activity-content">
                                                    ${largeImage ? `<img class="activity-image" src="${largeImage}" alt="">` : ''}
                                                    <div class="activity-details">
                                                        ${activity.details ? `<div class="activity-details-text">${activity.details}</div>` : ''}
                                                        ${activity.state ? `<div class="activity-state-text">${activity.state}</div>` : ''}
                                                    </div>
                                                </div>
                                            `;
                                            activitiesContainer.appendChild(activityDiv);
                                        }
                                    });
                                }
                            }
                        }
                    };
                    
                    ws.onerror = (error) => {};
                }
            })
            .catch(error => {});
    </script>
</body>
</html>